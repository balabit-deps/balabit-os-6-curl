From 2d119e90f8669e3c358468298941f48c15253f97 Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Sat, 7 Oct 2017 00:11:31 +0200
Subject: [PATCH] imap: if a FETCH response has no size, don't call write
 callback

---
 lib/imap.c | 5 +++++
 1 file changed, 5 insertions(+)

Index: curl-7.47.0/lib/imap.c
===================================================================
--- curl-7.47.0.orig/lib/imap.c	2017-10-17 13:53:39.420208253 -0400
+++ curl-7.47.0/lib/imap.c	2017-10-17 13:53:39.420208253 -0400
@@ -1136,6 +1136,11 @@ static CURLcode imap_state_fetch_resp(st
         /* The conversion from curl_off_t to size_t is always fine here */
         chunk = (size_t)size;
 
+      if(!chunk) {
+        /* no size, we're done with the data */
+        state(conn, IMAP_STOP);
+        return CURLE_OK;
+      }
       result = Curl_client_write(conn, CLIENTWRITE_BODY, pp->cache, chunk);
       if(result)
         return result;
