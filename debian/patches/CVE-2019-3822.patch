Backport of:

From ea9e76bc934ace9e260ab3d99438320b1f2ef501 Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Thu, 3 Jan 2019 12:59:28 +0100
Subject: [PATCH 2/3] ntlm: fix *_type3_message size check to avoid buffer
 overflow

---
 lib/vauth/ntlm.c | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

Index: curl-7.47.0/lib/curl_ntlm_msgs.c
===================================================================
--- curl-7.47.0.orig/lib/curl_ntlm_msgs.c	2019-01-29 08:50:49.715289599 -0500
+++ curl-7.47.0/lib/curl_ntlm_msgs.c	2019-01-29 08:57:29.328407660 -0500
@@ -748,11 +748,14 @@ CURLcode Curl_sasl_create_ntlm_type3_mes
   });
 
 #if USE_NTRESPONSES
-  if(size < (NTLM_BUFSIZE - ntresplen)) {
-    DEBUGASSERT(size == (size_t)ntrespoff);
-    memcpy(&ntlmbuf[size], ptr_ntresp, ntresplen);
-    size += ntresplen;
+  /* ntresplen + size should not be risking an integer overflow here */
+  if(ntresplen + size > sizeof(ntlmbuf)) {
+    failf(data, "incoming NTLM message too big");
+    return CURLE_OUT_OF_MEMORY;
   }
+  DEBUGASSERT(size == (size_t)ntrespoff);
+  memcpy(&ntlmbuf[size], ptr_ntresp, ntresplen);
+  size += ntresplen;
 
   DEBUG_OUT({
     fprintf(stderr, "\n   ntresp=");
