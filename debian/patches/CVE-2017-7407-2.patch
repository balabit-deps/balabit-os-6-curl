Backport of:

From 8e65877870c1fac920b65219adec720df810aab9 Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Fri, 24 Mar 2017 10:14:21 +0100
Subject: [PATCH] curl: check for end of input in writeout backslash handling

Reported-by: Brian Carpenter

Added test 1442 to verify
---
 src/tool_writeout.c     |  4 ++--
 tests/data/Makefile.inc |  2 +-
 tests/data/test1442     | 35 +++++++++++++++++++++++++++++++++++
 3 files changed, 38 insertions(+), 3 deletions(-)
 create mode 100644 tests/data/test1442

Index: curl-7.47.0/src/tool_writeout.c
===================================================================
--- curl-7.47.0.orig/src/tool_writeout.c	2017-10-04 08:51:37.353591709 -0400
+++ curl-7.47.0/src/tool_writeout.c	2017-10-04 08:51:37.349591659 -0400
@@ -298,7 +298,7 @@ void ourWriteOut(CURL *curl, struct OutS
         }
       }
     }
-    else if('\\' == *ptr) {
+    else if('\\' == *ptr && ptr[1]) {
       switch(ptr[1]) {
       case 'r':
         fputc('\r', stream);
Index: curl-7.47.0/tests/data/Makefile.inc
===================================================================
--- curl-7.47.0.orig/tests/data/Makefile.inc	2017-10-04 08:51:34.433555277 -0400
+++ curl-7.47.0/tests/data/Makefile.inc	2017-10-04 08:52:02.633907046 -0400
@@ -148,7 +148,7 @@ test1408 test1409 test1410 test1411 test
 test1416 test1417 test1418 test1419 test1420 test1421 test1422 test1423 \
 test1424 \
 test1428 test1429 test1430 test1431 test1432 test1433 test1434 test1435 \
-test1436 \
+test1436 test1442 \
 \
 test1500 test1501 test1502 test1503 test1504 test1505 test1506 test1507 \
 test1508 test1509 test1510 test1511 test1512 test1513 test1514 test1515 \
Index: curl-7.47.0/tests/data/test1442
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ curl-7.47.0/tests/data/test1442	2017-10-04 08:51:37.349591659 -0400
@@ -0,0 +1,35 @@
+<testcase>
+<info>
+<keywords>
+--write-out
+FILE
+</keywords>
+</info>
+# Server-side
+<reply>
+</reply>
+
+# Client-side
+<client>
+<server>
+file
+</server>
+
+<name>
+Check --write-out with trailing \
+</name>
+<command>
+file://localhost/%PWD/log/non-existent-file.txt --write-out '\'
+</command>
+</client>
+
+# Verify data
+<verify>
+<errorcode>
+37
+</errorcode>
+<stdout nonewline="yes">
+\
+</stdout>
+</verify>
+</testcase>
